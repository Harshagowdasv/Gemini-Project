<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatGPT Chat → PDF Exporter Demo</title>

<!-- jsPDF + html2canvas CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link rel="stylesheet" src="./style.css">

</head>

<body>

<div class="container">
<h2>ChatGPT Chat → PDF Exporter</h2>

<input type="text" id="chatLink" placeholder="Paste Shared ChatGPT Link here..." />

<button onclick="loadChat()">Load Chat</button>

<div id="preview"></div>

<button id="downloadBtn" onclick="generatePDF()">Download PDF</button>
</div>

<script>
const { jsPDF } = window.jspdf;

async function loadChat(){
    const link = document.getElementById("chatLink").value;
    const preview = document.getElementById("preview");

    if(!link){
        alert("Paste a shared chat link");
        return;
    }

    try{
        preview.innerHTML = "Loading chat...";

        // Fetch shared chat page
        const res = await fetch(link);
        const text = await res.text();

        // Parse HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(text,"text/html");

        // NOTE:
        // Shared ChatGPT pages store messages inside main tags.
        // We extract visible text only.
        const content = doc.querySelector("main");

        if(!content){
            preview.innerHTML = "Unable to extract chat content.";
            return;
        }

        preview.innerHTML = content.innerText;

        document.getElementById("downloadBtn").style.display="block";

    }catch(err){
        preview.innerHTML = "Error loading chat (CORS may block some links)";
        console.error(err);
    }
}

async function generatePDF(){
    const preview = document.getElementById("preview");

    const canvas = await html2canvas(preview,{
        scale:2
    });

    const imgData = canvas.toDataURL("image/png");

    const pdf = new jsPDF("p","mm","a4");

    const imgWidth = 210;
    const pageHeight = 297;
    const imgHeight = canvas.height * imgWidth / canvas.width;

    let heightLeft = imgHeight;
    let position = 0;

    pdf.addImage(imgData,"PNG",0,position,imgWidth,imgHeight);
    heightLeft -= pageHeight;

    while(heightLeft >= 0){
        position = heightLeft - imgHeight;
        pdf.addPage();
        pdf.addImage(imgData,"PNG",0,position,imgWidth,imgHeight);
        heightLeft -= pageHeight;
    }

    pdf.save("chatgpt-chat.pdf");
}
</script>

</body>
</html>
